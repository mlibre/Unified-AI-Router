<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>AI Chatbot</title>

	<!-- Favicons -->
	<link rel="icon" type="image/png" sizes="32x32" href="favicons/favicon-16x16.png">
	<link rel="apple-touch-icon" sizes="180x180" href="favicons/apple-touch-icon.png">
	<link rel="icon" type="image/x-icon" href="favicons/favicon.ico">

	<style>
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}

		:root {
			--bg-primary: #ffffff;
			--bg-secondary: #f8f9fa;
			--text-primary: #1a1a1a;
			--text-secondary: #6c757d;
			--border-color: #e9ecef;
			--user-msg-bg: #007bff;
			--user-msg-text: #ffffff;
			--ai-msg-bg: #f8f9fa;
			--ai-msg-text: #1a1a1a;
			--input-bg: #ffffff;
			--shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
			--shadow-hover: 0 4px 12px rgba(0, 0, 0, 0.12);
		}

		.dark-mode {
			--bg-primary: #1a1a1a;
			--bg-secondary: #2d2d2d;
			--text-primary: #e9ecef;
			--text-secondary: #adb5bd;
			--border-color: #3d3d3d;
			--user-msg-bg: #0d6efd;
			--user-msg-text: #ffffff;
			--ai-msg-bg: #2d2d2d;
			--ai-msg-text: #e9ecef;
			--input-bg: #2d2d2d;
			--shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
			--shadow-hover: 0 4px 12px rgba(0, 0, 0, 0.4);
		}

		body {
			font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
			background: var(--bg-primary);
			color: var(--text-primary);
			height: 100vh;
			overflow: hidden;
			transition: background 0.3s ease, color 0.3s ease;
		}

		/* Layout */
		.app-container {
			display: flex;
			height: 100vh;
		}

		/* Sidebar */
		.sidebar {
			width: 280px;
			background: var(--bg-secondary);
			border-right: 1px solid var(--border-color);
			display: flex;
			flex-direction: column;
			transition: transform 0.3s ease;
		}

		.sidebar-header {
			padding: 1rem 1.25rem;
			border-bottom: 1px solid var(--border-color);
		}

		.sidebar-header h2 {
			font-size: 1rem;
			font-weight: 600;
			margin-bottom: 0.75rem;
		}

		.new-chat-btn {
			width: 100%;
			padding: 0.625rem;
			background: var(--user-msg-bg);
			color: var(--user-msg-text);
			border: none;
			border-radius: 8px;
			font-size: 0.875rem;
			font-weight: 500;
			cursor: pointer;
			transition: opacity 0.2s ease;
		}

		.new-chat-btn:hover {
			opacity: 0.9;
		}

		.conversations-list {
			flex: 1;
			overflow-y: auto;
			padding: 0.5rem;
		}

		.conversations-list::-webkit-scrollbar {
			width: 6px;
		}

		.conversations-list::-webkit-scrollbar-track {
			background: transparent;
		}

		.conversations-list::-webkit-scrollbar-thumb {
			background: var(--border-color);
			border-radius: 3px;
		}

		.conversation-item {
			display: flex;
			align-items: center;
			gap: 0.5rem;
			padding: 0.75rem;
			margin-bottom: 0.25rem;
			border-radius: 8px;
			cursor: pointer;
			transition: background 0.2s ease;
		}

		.conversation-item:hover {
			background: var(--bg-primary);
		}

		.conversation-item.active {
			background: var(--bg-primary);
			font-weight: 500;
		}

		.conversation-title {
			flex: 1;
			font-size: 0.875rem;
			white-space: nowrap;
			overflow: hidden;
			text-overflow: ellipsis;
		}

		.delete-btn {
			opacity: 0;
			padding: 0.25rem 0.5rem;
			background: transparent;
			border: none;
			color: var(--text-secondary);
			cursor: pointer;
			border-radius: 4px;
			transition: all 0.2s ease;
			font-size: 0.875rem;
		}

		.conversation-item:hover .delete-btn {
			opacity: 1;
		}

		.delete-btn:hover {
			background: rgba(220, 53, 69, 0.1);
			color: #dc3545;
		}

		.sidebar-footer {
			padding: 1rem 1.25rem;
			border-top: 1px solid var(--border-color);
		}

		.sidebar-footer .btn {
			width: 100%;
			padding: 0.625rem;
			margin-bottom: 0.5rem;
			background: transparent;
			border: none;
			border-radius: 8px;
			cursor: pointer;
			transition: background 0.2s ease;
			color: var(--text-primary);
			font-size: 0.875rem;
		}

		.sidebar-footer .btn:hover {
			background: var(--bg-primary);
		}

		.container {
			display: flex;
			flex-direction: column;
			flex: 1;
			height: 100vh;
		}

		/* Mobile sidebar toggle */
		.sidebar-toggle {
			display: none;
			position: fixed;
			top: 1rem;
			left: 1rem;
			z-index: 100;
			width: 40px;
			height: 40px;
			background: var(--bg-secondary);
			border: 1px solid var(--border-color);
			border-radius: 8px;
			cursor: pointer;
			align-items: center;
			justify-content: center;
		}

		.sidebar-overlay {
			display: none;
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background: rgba(0, 0, 0, 0.5);
			z-index: 999;
		}

		@media (max-width: 768px) {
			.sidebar {
				position: fixed;
				left: 0;
				top: 0;
				height: 100vh;
				z-index: 1000;
				transform: translateX(-100%);
			}

			.sidebar.open {
				transform: translateX(0);
			}

			.sidebar-overlay.active {
				display: block;
			}

			.sidebar-toggle {
				display: flex;
			}
		}

		/* Header */
		.header {
			display: flex;
			align-items: center;
			justify-content: space-between;
			padding: 1rem 1.5rem;
			border-bottom: 1px solid var(--border-color);
			background: var(--bg-primary);
		}

		.header h1 {
			font-size: 1.25rem;
			font-weight: 600;
			color: var(--text-primary);
		}

		.header-actions {
			display: flex;
			gap: 0.5rem;
		}

		.btn {
			padding: 0.5rem 1rem;
			border: none;
			border-radius: 8px;
			font-size: 0.875rem;
			font-weight: 500;
			cursor: pointer;
			transition: all 0.2s ease;
			background: transparent;
			color: var(--text-secondary);
		}

		.btn:hover {
			background: var(--bg-secondary);
			color: var(--text-primary);
		}

		.btn-primary {
			background: var(--user-msg-bg);
			color: var(--user-msg-text);
		}

		.btn-primary:hover {
			opacity: 0.9;
		}

		.icon-btn {
			width: 40px;
			height: 40px;
			padding: 0;
			display: flex;
			align-items: center;
			justify-content: center;
			border-radius: 50%;
		}

		/* Chat Area */
		.chat-area {
			flex: 1;
			overflow-y: auto;
			padding: 2rem 1.5rem;
			scroll-behavior: smooth;
		}

		.chat-area::-webkit-scrollbar {
			width: 6px;
		}

		.chat-area::-webkit-scrollbar-track {
			background: transparent;
		}

		.chat-area::-webkit-scrollbar-thumb {
			background: var(--border-color);
			border-radius: 3px;
		}

		.chat-area::-webkit-scrollbar-thumb:hover {
			background: var(--text-secondary);
		}

		/* Welcome Screen */
		.welcome {
			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: center;
			height: 100%;
			text-align: center;
			padding: 2rem;
		}

		.welcome-icon {
			width: 64px;
			height: 64px;
			background: var(--bg-secondary);
			border-radius: 16px;
			display: flex;
			align-items: center;
			justify-content: center;
			margin-bottom: 1.5rem;
		}

		.welcome h2 {
			font-size: 1.75rem;
			font-weight: 600;
			margin-bottom: 0.5rem;
		}

		.welcome p {
			color: var(--text-secondary);
			margin-bottom: 2rem;
			max-width: 500px;
		}

		/* Messages */
		.messages {
			display: flex;
			flex-direction: column;
			gap: 1.5rem;
		}

		.message {
			display: flex;
			gap: 1rem;
			animation: fadeIn 0.3s ease;
		}

		@keyframes fadeIn {
			from {
				opacity: 0;
				transform: translateY(10px);
			}

			to {
				opacity: 1;
				transform: translateY(0);
			}
		}

		.message.user {
			flex-direction: row-reverse;
		}

		.message-avatar {
			width: 36px;
			height: 36px;
			border-radius: 50%;
			display: flex;
			align-items: center;
			justify-content: center;
			flex-shrink: 0;
			font-size: 0.875rem;
			font-weight: 600;
		}

		.message.user .message-avatar {
			background: var(--user-msg-bg);
			color: var(--user-msg-text);
		}

		.message.assistant .message-avatar {
			background: var(--bg-secondary);
			color: var(--text-primary);
		}

		.message-content {
			flex: 1;
			max-width: 75%;
		}

		.message-bubble {
			padding: 1rem 1.25rem;
			border-radius: 16px;
			line-height: 1.6;
			word-wrap: break-word;
		}

		.message.user .message-bubble {
			background: var(--user-msg-bg);
			color: var(--user-msg-text);
			border-bottom-right-radius: 4px;
		}

		.message.assistant .message-bubble {
			background: var(--ai-msg-bg);
			color: var(--ai-msg-text);
			border-bottom-left-radius: 4px;
			box-shadow: var(--shadow);
		}

		/* Typing Indicator */
		.typing-indicator {
			display: flex;
			gap: 4px;
			padding: 1rem 1.25rem;
		}

		.typing-dot {
			width: 8px;
			height: 8px;
			border-radius: 50%;
			background: var(--text-secondary);
			animation: typing 1.4s infinite;
		}

		.typing-dot:nth-child(2) {
			animation-delay: 0.2s;
		}

		.typing-dot:nth-child(3) {
			animation-delay: 0.4s;
		}

		@keyframes typing {

			0%,
			60%,
			100% {
				opacity: 0.3;
				transform: scale(0.8);
			}

			30% {
				opacity: 1;
				transform: scale(1);
			}
		}

		/* Input Area */
		.input-area {
			padding: 1rem 1.5rem 1.5rem;
			border-top: 1px solid var(--border-color);
			background: var(--bg-primary);
		}

		.input-container {
			display: flex;
			gap: 0.75rem;
			align-items: flex-end;
			background: var(--input-bg);
			border: 1px solid var(--border-color);
			border-radius: 12px;
			padding: 1rem;
			box-shadow: var(--shadow);
			transition: box-shadow 0.2s ease;
		}

		.input-container:focus-within {
			box-shadow: var(--shadow-hover);
		}

		.input-container textarea {
			flex: 1;
			border: none;
			outline: none;
			background: transparent;
			color: var(--text-primary);
			font-family: inherit;
			font-size: 1rem;
			resize: none;
			max-height: 200px;
			line-height: 1.6;
			min-height: 48px;
		}

		.input-container textarea::placeholder {
			color: var(--text-secondary);
		}

		.send-btn {
			width: 40px;
			height: 40px;
			border-radius: 8px;
			background: var(--user-msg-bg);
			color: var(--user-msg-text);
			border: none;
			cursor: pointer;
			display: flex;
			align-items: center;
			justify-content: center;
			transition: opacity 0.2s ease;
			flex-shrink: 0;
		}

		.send-btn:disabled {
			opacity: 0.4;
			cursor: not-allowed;
		}

		.send-btn:not(:disabled):hover {
			opacity: 0.9;
		}

		.input-hint {
			text-align: center;
			margin-top: 0.75rem;
			font-size: 0.75rem;
			color: var(--text-secondary);
		}

		/* Markdown Styles */
		.markdown-content p {
			margin: 0.5rem 0;
		}

		.markdown-content p:first-child {
			margin-top: 0;
		}

		.markdown-content p:last-child {
			margin-bottom: 0;
		}

		.markdown-content code {
			background: var(--bg-secondary);
			padding: 0.125rem 0.375rem;
			border-radius: 4px;
			font-size: 0.875em;
			font-family: 'Courier New', monospace;
		}

		.markdown-content pre {
			background: var(--bg-secondary);
			padding: 1rem;
			border-radius: 8px;
			overflow-x: auto;
			margin: 0.75rem 0;
		}

		.markdown-content pre code {
			background: transparent;
			padding: 0;
		}

		.markdown-content ul,
		.markdown-content ol {
			margin: 0.5rem 0;
			padding-left: 1.5rem;
		}

		.markdown-content li {
			margin: 0.25rem 0;
		}

		.markdown-content h1,
		.markdown-content h2,
		.markdown-content h3 {
			margin: 1rem 0 0.5rem;
			font-weight: 600;
		}

		.markdown-content h1 {
			font-size: 1.5rem;
		}

		.markdown-content h2 {
			font-size: 1.25rem;
		}

		.markdown-content h3 {
			font-size: 1.125rem;
		}

		/* Settings Modal */
		.modal {
			display: none;
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background: rgba(0, 0, 0, 0.5);
			z-index: 2000;
			align-items: center;
			justify-content: center;
		}

		.modal.active {
			display: flex;
		}

		.modal-content {
			background: var(--bg-primary);
			border-radius: 16px;
			padding: 2rem;
			max-width: 500px;
			width: 90%;
			box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
		}

		.modal-header {
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin-bottom: 1.5rem;
		}

		.modal-header h3 {
			font-size: 1.25rem;
			font-weight: 600;
		}

		.modal-body {
			margin-bottom: 1.5rem;
		}

		.form-group {
			margin-bottom: 1.5rem;
		}

		.form-group label {
			display: block;
			margin-bottom: 0.5rem;
			font-weight: 500;
			font-size: 0.875rem;
		}

		.form-group select,
		.form-group input {
			width: 100%;
			padding: 0.75rem;
			border: 1px solid var(--border-color);
			border-radius: 8px;
			background: var(--input-bg);
			color: var(--text-primary);
			font-family: inherit;
			font-size: 0.9375rem;
		}

		.form-group input[type="range"] {
			padding: 0;
		}

		.range-value {
			display: block;
			margin-top: 0.5rem;
			font-size: 0.875rem;
			color: var(--text-secondary);
		}

		.modal-footer {
			display: flex;
			gap: 0.75rem;
			justify-content: flex-end;
		}

		/* Responsive */
		@media (max-width: 768px) {
			.header {
				padding: 1rem;
			}

			.chat-area {
				padding: 1.5rem 1rem;
			}

			.input-area {
				padding: 1rem;
			}

			.message-content {
				max-width: 85%;
			}

			.welcome h2 {
				font-size: 1.5rem;
			}
		}

		/* Utility */
		.hidden {
			display: none !important;
		}
	</style>
</head>

<body>
	<div class="app-container">
		<!-- Sidebar -->
		<aside class="sidebar" id="sidebar">
			<div class="sidebar-header">
				<h2>AI Chatbot</h2>
				<button class="new-chat-btn" onclick="createNewChat()">+ New Chat</button>
			</div>
			<div class="conversations-list" id="conversationsList">
				<!-- Conversations will be rendered here -->
			</div>
			<div class="sidebar-footer">
				<button class="btn" onclick="toggleTheme()">
					<span>üåì</span> Toggle Theme
				</button>
				<button class="btn" onclick="showSettings()">
					<span>‚öôÔ∏è</span> Settings
				</button>
			</div>
		</aside>

		<!-- Sidebar Overlay (Mobile) -->
		<div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>

		<!-- Sidebar Toggle (Mobile) -->
		<button class="sidebar-toggle" id="sidebarToggle" onclick="toggleSidebar()">
			<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
				<line x1="3" y1="12" x2="21" y2="12"></line>
				<line x1="3" y1="6" x2="21" y2="6"></line>
				<line x1="3" y1="18" x2="21" y2="18"></line>
			</svg>
		</button>

		<!-- Main Container -->
		<div class="container">
			<!-- Header -->
			<header class="header">
				<h1 id="chatTitle">AI Chatbot</h1>
				<div class="header-actions">
					<button class="btn" onclick="clearCurrentChat()">Clear</button>
				</div>
			</header>

			<!-- Chat Area -->
			<div class="chat-area" id="chatArea">
				<!-- Welcome Screen -->
				<div class="welcome" id="welcomeScreen">
					<div class="welcome-icon">
						<svg width="32" height="32" viewBox="0 0 32 32" fill="currentColor">
							<path
								d="M16 26C13.826 26 11.712 25.291 9.977 23.98C8.242 22.67 6.981 20.83 6.386 18.739C5.791 16.648 5.893 14.42 6.678 12.392C7.463 10.365 8.887 8.648 10.735 7.503C12.583 6.358 14.754 5.846 16.919 6.045C19.084 6.245 21.125 7.144 22.732 8.608C24.34 10.072 25.427 12.019 25.828 14.156C26.229 16.293 25.923 18.502 24.956 20.449L25.421 23.832L21.603 24.822C20.217 25.645 18.622 26.006 17 26H16Z" />
						</svg>
					</div>
					<h2>Welcome to AI Chatbot</h2>
					<p>Start a conversation and experience the power of AI. Ask me anything!</p>
				</div>

				<!-- Messages Container -->
				<div class="messages hidden" id="messagesContainer"></div>
			</div>

			<!-- Input Area -->
			<div class="input-area">
				<div class="input-container">
					<textarea id="messageInput" placeholder="Type your message..." rows="1" onkeydown="handleKeyPress(event)"
						oninput="handleInput()"></textarea>
					<button class="send-btn" id="sendBtn" onclick="sendMessage()" disabled>
						<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
							<line x1="22" y1="2" x2="11" y2="13"></line>
							<polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
						</svg>
					</button>
				</div>
				<div class="input-hint">AI may produce inaccurate information</div>
			</div>
		</div>
	</div>

	<!-- Settings Modal -->
	<div class="modal" id="settingsModal" onclick="closeModalOnBackdrop(event)">
		<div class="modal-content">
			<div class="modal-header">
				<h3>Settings</h3>
				<button class="btn icon-btn" onclick="closeSettings()">
					<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
						<line x1="18" y1="6" x2="6" y2="18"></line>
						<line x1="6" y1="6" x2="18" y2="18"></line>
					</svg>
				</button>
			</div>
			<div class="modal-body">
				<div class="form-group">
					<label for="modelSelect">Model</label>
					<select id="modelSelect">
						<option value="">Auto-select (Recommended)</option>
					</select>
				</div>
				<div class="form-group">
					<label for="temperatureSlider">Temperature</label>
					<input type="range" id="temperatureSlider" min="0" max="2" step="0.1" value="0.7"
						oninput="updateTemperatureValue()">
					<span class="range-value">Value: <span id="temperatureValue">0.7</span></span>
				</div>
			</div>
			<div class="modal-footer">
				<button class="btn" onclick="closeSettings()">Cancel</button>
				<button class="btn btn-primary" onclick="saveSettings()">Save</button>
			</div>
		</div>
	</div>

	<!-- Marked.js for Markdown -->
	<script src="marked.umd.js"></script>

	<script>
		// State
		let conversations = JSON.parse(localStorage.getItem('chatbot-conversations') || '[]');
		let currentConversationId = null;
		let isTyping = false;
		const API_BASE = window.location.origin;

		// Theme Management
		function toggleTheme() {
			document.body.classList.toggle('dark-mode');
			const isDark = document.body.classList.contains('dark-mode');
			localStorage.setItem('theme', isDark ? 'dark' : 'light');
		}

		// Initialize theme
		const savedTheme = localStorage.getItem('theme');
		if (savedTheme === 'dark' || (!savedTheme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
			document.body.classList.add('dark-mode');
		}

		// Sidebar Management
		function toggleSidebar() {
			const sidebar = document.getElementById('sidebar');
			const overlay = document.getElementById('sidebarOverlay');
			sidebar.classList.toggle('open');
			overlay.classList.toggle('active');
		}

		// Conversation Management
		function createNewChat() {
			const newConv = {
				id: Date.now(),
				title: 'New Chat',
				messages: [],
				created: new Date().toISOString()
			};
			conversations.unshift(newConv);
			saveConversations();
			loadConversation(newConv.id);
			renderConversationsList();
		}

		function loadConversation(id) {
			currentConversationId = id;
			const conv = conversations.find(c => c.id === id);
			if (!conv) return;

			renderMessages(conv.messages);
			renderConversationsList();
			document.getElementById('chatTitle').textContent = conv.title;

			// Close sidebar on mobile
			if (window.innerWidth <= 768) {
				toggleSidebar();
			}
		}

		function deleteConversation(id, event) {
			event.stopPropagation();
			if (!confirm('Delete this conversation?')) return;

			conversations = conversations.filter(c => c.id !== id);
			saveConversations();

			if (currentConversationId === id) {
				if (conversations.length > 0) {
					loadConversation(conversations[0].id);
				} else {
					currentConversationId = null;
					renderMessages([]);
					document.getElementById('chatTitle').textContent = 'AI Chatbot';
				}
			}

			renderConversationsList();
		}

		function saveConversations() {
			localStorage.setItem('chatbot-conversations', JSON.stringify(conversations));
		}

		function renderConversationsList() {
			const container = document.getElementById('conversationsList');

			if (conversations.length === 0) {
				container.innerHTML = '<div style="padding: 1rem; text-align: center; color: var(--text-secondary); font-size: 0.875rem;">No conversations yet</div>';
				return;
			}

			container.innerHTML = conversations.map(conv => `
				<div class="conversation-item ${currentConversationId === conv.id ? 'active' : ''}" onclick="loadConversation(${conv.id})">
					<div class="conversation-title">${escapeHtml(conv.title)}</div>
					<button class="delete-btn" onclick="deleteConversation(${conv.id}, event)">√ó</button>
				</div>
			`).join('');
		}

		function clearCurrentChat() {
			if (!currentConversationId) return;
			if (!confirm('Clear all messages in this chat?')) return;

			const conv = conversations.find(c => c.id === currentConversationId);
			if (conv) {
				conv.messages = [];
				conv.title = 'New Chat';
				saveConversations();
				renderMessages([]);
				renderConversationsList();
				document.getElementById('chatTitle').textContent = 'New Chat';
			}
		}

		// Input handling
		function handleInput() {
			const input = document.getElementById('messageInput');
			const sendBtn = document.getElementById('sendBtn');

			// Auto-resize textarea
			input.style.height = 'auto';
			input.style.height = input.scrollHeight + 'px';

			// Enable/disable send button
			sendBtn.disabled = !input.value.trim() || isTyping;
		}

		function handleKeyPress(event) {
			if (event.key === 'Enter' && !event.shiftKey) {
				event.preventDefault();
				sendMessage();
			}
		}

		// Message handling
		async function sendMessage() {
			const input = document.getElementById('messageInput');
			const text = input.value.trim();

			if (!text || isTyping) return;

			// Create new conversation if none exists
			if (!currentConversationId) {
				createNewChat();
			}

			const conv = conversations.find(c => c.id === currentConversationId);
			if (!conv) return;

			// Add user message
			conv.messages.push({ role: 'user', content: text, timestamp: Date.now() });

			// Update conversation title from first message
			if (conv.messages.filter(m => m.role === 'user').length === 1) {
				conv.title = text.substring(0, 50) + (text.length > 50 ? '...' : '');
				document.getElementById('chatTitle').textContent = conv.title;
			}

			saveConversations();
			renderMessages(conv.messages);
			renderConversationsList();

			// Clear input
			input.value = '';
			input.style.height = 'auto';
			handleInput();

			// Show typing indicator
			showTypingIndicator();

			try {
				const response = await fetch(`${API_BASE}/v1/chat/completions`, {
					method: 'POST',
					headers: { 'Content-Type': 'application/json' },
					body: JSON.stringify({
						messages: conv.messages.map(m => ({ role: m.role, content: m.content })),
						model: document.getElementById('modelSelect').value || undefined,
						temperature: parseFloat(document.getElementById('temperatureSlider').value),
						stream: false
					})
				});

				if (!response.ok) {
					throw new Error(`HTTP error! status: ${response.status}`);
				}

				const data = await response.json();
				const assistantMessage = data.choices[0]?.message?.content || 'Sorry, I couldn\'t generate a response.';

				hideTypingIndicator();

				// Add assistant message
				conv.messages.push({ role: 'assistant', content: assistantMessage, timestamp: Date.now() });
				saveConversations();
				renderMessages(conv.messages);

			} catch (error) {
				console.error('Error:', error);
				hideTypingIndicator();
				conv.messages.push({ role: 'assistant', content: `Error: ${error.message}`, timestamp: Date.now() });
				saveConversations();
				renderMessages(conv.messages);
			}
		}

		function renderMessages(messages) {
			const welcomeScreen = document.getElementById('welcomeScreen');
			const messagesContainer = document.getElementById('messagesContainer');

			if (messages.length === 0) {
				welcomeScreen.classList.remove('hidden');
				messagesContainer.classList.add('hidden');
				return;
			}

			welcomeScreen.classList.add('hidden');
			messagesContainer.classList.remove('hidden');

			messagesContainer.innerHTML = messages.map(msg => {
				const avatar = msg.role === 'user' ? 'U' : 'AI';
				const content = msg.role === 'assistant'
					? `<div class="markdown-content">${marked.parse(msg.content)}</div>`
					: escapeHtml(msg.content);

				return `
					<div class="message ${msg.role}">
						<div class="message-avatar">${avatar}</div>
						<div class="message-content">
							<div class="message-bubble">${content}</div>
						</div>
					</div>
				`;
			}).join('');

			scrollToBottom();
		}

		function showTypingIndicator() {
			isTyping = true;
			const messagesContainer = document.getElementById('messagesContainer');

			const typingHtml = `
				<div class="message assistant" id="typingIndicator">
					<div class="message-avatar">AI</div>
					<div class="message-content">
						<div class="message-bubble">
							<div class="typing-indicator">
								<div class="typing-dot"></div>
								<div class="typing-dot"></div>
								<div class="typing-dot"></div>
							</div>
						</div>
					</div>
				</div>
			`;

			messagesContainer.insertAdjacentHTML('beforeend', typingHtml);
			scrollToBottom();
		}

		function hideTypingIndicator() {
			isTyping = false;
			const indicator = document.getElementById('typingIndicator');
			if (indicator) indicator.remove();
		}

		function scrollToBottom() {
			const chatArea = document.getElementById('chatArea');
			chatArea.scrollTop = chatArea.scrollHeight;
		}

		// Settings
		function showSettings() {
			document.getElementById('settingsModal').classList.add('active');
		}

		function closeSettings() {
			document.getElementById('settingsModal').classList.remove('active');
		}

		function closeModalOnBackdrop(event) {
			if (event.target.classList.contains('modal')) {
				closeSettings();
			}
		}

		function updateTemperatureValue() {
			const slider = document.getElementById('temperatureSlider');
			document.getElementById('temperatureValue').textContent = slider.value;
		}

		function saveSettings() {
			closeSettings();
		}

		// Utility
		function escapeHtml(text) {
			const div = document.createElement('div');
			div.textContent = text;
			return div.innerHTML;
		}

		// Configure marked
		marked.setOptions({
			breaks: true,
			gfm: true
		});

		// Initialize
		renderConversationsList();
		if (conversations.length > 0) {
			loadConversation(conversations[0].id);
		}
		document.getElementById('messageInput').focus();
	</script>
</body>

</html>