<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>AI Chatbot</title>

	<!-- Favicons -->
	<link rel="icon" type="image/png" sizes="32x32" href="favicons/favicon-16x16.png">
	<link rel="apple-touch-icon" sizes="180x180" href="favicons/apple-touch-icon.png">
	<link rel="icon" type="image/x-icon" href="favicons/favicon.ico">

	<!-- Google Fonts -->
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">

	<style>
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}

		:root {
			--bg-primary: #ffffff;
			--bg-secondary: #f8f9fa;
			--text-primary: #1a1a1a;
			--text-secondary: #6c757d;
			--border-color: #e9ecef;
			--user-msg-bg: #007bff;
			--user-msg-text: #ffffff;
			--ai-msg-bg: #f8f9fa;
			--ai-msg-text: #1a1a1a;
			--input-bg: #ffffff;
			--shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
			--shadow-hover: 0 4px 12px rgba(0, 0, 0, 0.12);
		}

		.dark-mode {
			--bg-primary: #1a1a1a;
			--bg-secondary: #2d2d2d;
			--text-primary: #e9ecef;
			--text-secondary: #adb5bd;
			--border-color: #3d3d3d;
			--user-msg-bg: #0d6efd;
			--user-msg-text: #ffffff;
			--ai-msg-bg: #2d2d2d;
			--ai-msg-text: #e9ecef;
			--input-bg: #2d2d2d;
			--shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
			--shadow-hover: 0 4px 12px rgba(0, 0, 0, 0.4);
		}

		body {
			font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
			background: var(--bg-primary);
			color: var(--text-primary);
			height: 100vh;
			overflow: hidden;
			transition: background 0.3s ease, color 0.3s ease;
		}

		/* Layout */
		.container {
			display: flex;
			flex-direction: column;
			height: 100vh;
			max-width: 900px;
			margin: 0 auto;
			padding: 0;
		}

		/* Header */
		.header {
			display: flex;
			align-items: center;
			justify-content: space-between;
			padding: 1rem 1.5rem;
			border-bottom: 1px solid var(--border-color);
			background: var(--bg-primary);
		}

		.header h1 {
			font-size: 1.25rem;
			font-weight: 600;
			color: var(--text-primary);
		}

		.header-actions {
			display: flex;
			gap: 0.5rem;
		}

		.btn {
			padding: 0.5rem 1rem;
			border: none;
			border-radius: 8px;
			font-size: 0.875rem;
			font-weight: 500;
			cursor: pointer;
			transition: all 0.2s ease;
			background: transparent;
			color: var(--text-secondary);
		}

		.btn:hover {
			background: var(--bg-secondary);
			color: var(--text-primary);
		}

		.btn-primary {
			background: var(--user-msg-bg);
			color: var(--user-msg-text);
		}

		.btn-primary:hover {
			opacity: 0.9;
		}

		.icon-btn {
			width: 40px;
			height: 40px;
			padding: 0;
			display: flex;
			align-items: center;
			justify-content: center;
			border-radius: 50%;
		}

		/* Chat Area */
		.chat-area {
			flex: 1;
			overflow-y: auto;
			padding: 2rem 1.5rem;
			scroll-behavior: smooth;
		}

		.chat-area::-webkit-scrollbar {
			width: 6px;
		}

		.chat-area::-webkit-scrollbar-track {
			background: transparent;
		}

		.chat-area::-webkit-scrollbar-thumb {
			background: var(--border-color);
			border-radius: 3px;
		}

		.chat-area::-webkit-scrollbar-thumb:hover {
			background: var(--text-secondary);
		}

		/* Welcome Screen */
		.welcome {
			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: center;
			height: 100%;
			text-align: center;
			padding: 2rem;
		}

		.welcome-icon {
			width: 64px;
			height: 64px;
			background: var(--bg-secondary);
			border-radius: 16px;
			display: flex;
			align-items: center;
			justify-content: center;
			margin-bottom: 1.5rem;
		}

		.welcome h2 {
			font-size: 1.75rem;
			font-weight: 600;
			margin-bottom: 0.5rem;
		}

		.welcome p {
			color: var(--text-secondary);
			margin-bottom: 2rem;
			max-width: 500px;
		}

		/* Messages */
		.messages {
			display: flex;
			flex-direction: column;
			gap: 1.5rem;
		}

		.message {
			display: flex;
			gap: 1rem;
			animation: fadeIn 0.3s ease;
		}

		@keyframes fadeIn {
			from {
				opacity: 0;
				transform: translateY(10px);
			}

			to {
				opacity: 1;
				transform: translateY(0);
			}
		}

		.message.user {
			flex-direction: row-reverse;
		}

		.message-avatar {
			width: 36px;
			height: 36px;
			border-radius: 50%;
			display: flex;
			align-items: center;
			justify-content: center;
			flex-shrink: 0;
			font-size: 0.875rem;
			font-weight: 600;
		}

		.message.user .message-avatar {
			background: var(--user-msg-bg);
			color: var(--user-msg-text);
		}

		.message.assistant .message-avatar {
			background: var(--bg-secondary);
			color: var(--text-primary);
		}

		.message-content {
			flex: 1;
			max-width: 75%;
		}

		.message-bubble {
			padding: 1rem 1.25rem;
			border-radius: 16px;
			line-height: 1.6;
			word-wrap: break-word;
		}

		.message.user .message-bubble {
			background: var(--user-msg-bg);
			color: var(--user-msg-text);
			border-bottom-right-radius: 4px;
		}

		.message.assistant .message-bubble {
			background: var(--ai-msg-bg);
			color: var(--ai-msg-text);
			border-bottom-left-radius: 4px;
			box-shadow: var(--shadow);
		}

		/* Typing Indicator */
		.typing-indicator {
			display: flex;
			gap: 4px;
			padding: 1rem 1.25rem;
		}

		.typing-dot {
			width: 8px;
			height: 8px;
			border-radius: 50%;
			background: var(--text-secondary);
			animation: typing 1.4s infinite;
		}

		.typing-dot:nth-child(2) {
			animation-delay: 0.2s;
		}

		.typing-dot:nth-child(3) {
			animation-delay: 0.4s;
		}

		@keyframes typing {

			0%,
			60%,
			100% {
				opacity: 0.3;
				transform: scale(0.8);
			}

			30% {
				opacity: 1;
				transform: scale(1);
			}
		}

		/* Input Area */
		.input-area {
			padding: 1rem 1.5rem 1.5rem;
			border-top: 1px solid var(--border-color);
			background: var(--bg-primary);
		}

		.input-container {
			display: flex;
			gap: 0.75rem;
			align-items: flex-end;
			background: var(--input-bg);
			border: 1px solid var(--border-color);
			border-radius: 12px;
			padding: 0.75rem;
			box-shadow: var(--shadow);
			transition: box-shadow 0.2s ease;
		}

		.input-container:focus-within {
			box-shadow: var(--shadow-hover);
		}

		.input-container textarea {
			flex: 1;
			border: none;
			outline: none;
			background: transparent;
			color: var(--text-primary);
			font-family: inherit;
			font-size: 0.9375rem;
			resize: none;
			max-height: 150px;
			line-height: 1.5;
		}

		.input-container textarea::placeholder {
			color: var(--text-secondary);
		}

		.send-btn {
			width: 36px;
			height: 36px;
			border-radius: 8px;
			background: var(--user-msg-bg);
			color: var(--user-msg-text);
			border: none;
			cursor: pointer;
			display: flex;
			align-items: center;
			justify-content: center;
			transition: opacity 0.2s ease;
			flex-shrink: 0;
		}

		.send-btn:disabled {
			opacity: 0.4;
			cursor: not-allowed;
		}

		.send-btn:not(:disabled):hover {
			opacity: 0.9;
		}

		.input-hint {
			text-align: center;
			margin-top: 0.75rem;
			font-size: 0.75rem;
			color: var(--text-secondary);
		}

		/* Markdown Styles */
		.markdown-content p {
			margin: 0.5rem 0;
		}

		.markdown-content p:first-child {
			margin-top: 0;
		}

		.markdown-content p:last-child {
			margin-bottom: 0;
		}

		.markdown-content code {
			background: var(--bg-secondary);
			padding: 0.125rem 0.375rem;
			border-radius: 4px;
			font-size: 0.875em;
			font-family: 'Courier New', monospace;
		}

		.markdown-content pre {
			background: var(--bg-secondary);
			padding: 1rem;
			border-radius: 8px;
			overflow-x: auto;
			margin: 0.75rem 0;
		}

		.markdown-content pre code {
			background: transparent;
			padding: 0;
		}

		.markdown-content ul,
		.markdown-content ol {
			margin: 0.5rem 0;
			padding-left: 1.5rem;
		}

		.markdown-content li {
			margin: 0.25rem 0;
		}

		.markdown-content h1,
		.markdown-content h2,
		.markdown-content h3 {
			margin: 1rem 0 0.5rem;
			font-weight: 600;
		}

		.markdown-content h1 {
			font-size: 1.5rem;
		}

		.markdown-content h2 {
			font-size: 1.25rem;
		}

		.markdown-content h3 {
			font-size: 1.125rem;
		}

		/* Settings Modal */
		.modal {
			display: none;
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background: rgba(0, 0, 0, 0.5);
			z-index: 1000;
			align-items: center;
			justify-content: center;
		}

		.modal.active {
			display: flex;
		}

		.modal-content {
			background: var(--bg-primary);
			border-radius: 16px;
			padding: 2rem;
			max-width: 500px;
			width: 90%;
			box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
		}

		.modal-header {
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin-bottom: 1.5rem;
		}

		.modal-header h3 {
			font-size: 1.25rem;
			font-weight: 600;
		}

		.modal-body {
			margin-bottom: 1.5rem;
		}

		.form-group {
			margin-bottom: 1.5rem;
		}

		.form-group label {
			display: block;
			margin-bottom: 0.5rem;
			font-weight: 500;
			font-size: 0.875rem;
		}

		.form-group select,
		.form-group input {
			width: 100%;
			padding: 0.75rem;
			border: 1px solid var(--border-color);
			border-radius: 8px;
			background: var(--input-bg);
			color: var(--text-primary);
			font-family: inherit;
			font-size: 0.9375rem;
		}

		.form-group input[type="range"] {
			padding: 0;
		}

		.range-value {
			display: block;
			margin-top: 0.5rem;
			font-size: 0.875rem;
			color: var(--text-secondary);
		}

		.modal-footer {
			display: flex;
			gap: 0.75rem;
			justify-content: flex-end;
		}

		/* Responsive */
		@media (max-width: 768px) {
			.header {
				padding: 1rem;
			}

			.chat-area {
				padding: 1.5rem 1rem;
			}

			.input-area {
				padding: 1rem;
			}

			.message-content {
				max-width: 85%;
			}

			.welcome h2 {
				font-size: 1.5rem;
			}
		}

		/* Utility */
		.hidden {
			display: none !important;
		}
	</style>
</head>

<body>
	<div class="container">
		<!-- Header -->
		<header class="header">
			<h1>AI Chatbot</h1>
			<div class="header-actions">
				<button class="btn icon-btn" onclick="toggleTheme()" title="Toggle theme">
					<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
						<circle cx="12" cy="12" r="5"></circle>
						<line x1="12" y1="1" x2="12" y2="3"></line>
						<line x1="12" y1="21" x2="12" y2="23"></line>
						<line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
						<line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
						<line x1="1" y1="12" x2="3" y2="12"></line>
						<line x1="21" y1="12" x2="23" y2="12"></line>
						<line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
						<line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
					</svg>
				</button>
				<button class="btn icon-btn" onclick="showSettings()" title="Settings">
					<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
						<circle cx="12" cy="12" r="3"></circle>
						<path
							d="M12 1v6m0 6v6m5.196-15.804l-4.242 4.242m-5.908 5.908l-4.242 4.242M23 12h-6m-6 0H1m15.804 5.196l-4.242-4.242m-5.908-5.908l-4.242-4.242">
						</path>
					</svg>
				</button>
				<button class="btn" onclick="clearChat()">Clear</button>
			</div>
		</header>

		<!-- Chat Area -->
		<div class="chat-area" id="chatArea">
			<!-- Welcome Screen -->
			<div class="welcome" id="welcomeScreen">
				<div class="welcome-icon">
					<svg width="32" height="32" viewBox="0 0 32 32" fill="currentColor">
						<path
							d="M16 26C13.826 26 11.712 25.291 9.977 23.98C8.242 22.67 6.981 20.83 6.386 18.739C5.791 16.648 5.893 14.42 6.678 12.392C7.463 10.365 8.887 8.648 10.735 7.503C12.583 6.358 14.754 5.846 16.919 6.045C19.084 6.245 21.125 7.144 22.732 8.608C24.34 10.072 25.427 12.019 25.828 14.156C26.229 16.293 25.923 18.502 24.956 20.449L25.421 23.832L21.603 24.822C20.217 25.645 18.622 26.006 17 26H16Z" />
					</svg>
				</div>
				<h2>Welcome to AI Chatbot</h2>
				<p>Start a conversation and experience the power of AI. Ask me anything!</p>
			</div>

			<!-- Messages Container -->
			<div class="messages hidden" id="messagesContainer"></div>
		</div>

		<!-- Input Area -->
		<div class="input-area">
			<div class="input-container">
				<textarea id="messageInput" placeholder="Type your message..." rows="1" onkeydown="handleKeyPress(event)"
					oninput="handleInput()"></textarea>
				<button class="send-btn" id="sendBtn" onclick="sendMessage()" disabled>
					<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
						<line x1="22" y1="2" x2="11" y2="13"></line>
						<polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
					</svg>
				</button>
			</div>
			<div class="input-hint">AI may produce inaccurate information</div>
		</div>
	</div>

	<!-- Settings Modal -->
	<div class="modal" id="settingsModal" onclick="closeModalOnBackdrop(event)">
		<div class="modal-content">
			<div class="modal-header">
				<h3>Settings</h3>
				<button class="btn icon-btn" onclick="closeSettings()">
					<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
						<line x1="18" y1="6" x2="6" y2="18"></line>
						<line x1="6" y1="6" x2="18" y2="18"></line>
					</svg>
				</button>
			</div>
			<div class="modal-body">
				<div class="form-group">
					<label for="modelSelect">Model</label>
					<select id="modelSelect">
						<option value="">Auto-select (Recommended)</option>
					</select>
				</div>
				<div class="form-group">
					<label for="temperatureSlider">Temperature</label>
					<input type="range" id="temperatureSlider" min="0" max="2" step="0.1" value="0.7"
						oninput="updateTemperatureValue()">
					<span class="range-value">Value: <span id="temperatureValue">0.7</span></span>
				</div>
			</div>
			<div class="modal-footer">
				<button class="btn" onclick="closeSettings()">Cancel</button>
				<button class="btn btn-primary" onclick="saveSettings()">Save</button>
			</div>
		</div>
	</div>

	<!-- Marked.js for Markdown -->
	<script src="marked.umd.js"></script>

	<script>
		// State
		let messages = [];
		let isTyping = false;
		const API_BASE = window.location.origin;

		// Theme Management
		function toggleTheme() {
			document.body.classList.toggle('dark-mode');
			const isDark = document.body.classList.contains('dark-mode');
			localStorage.setItem('theme', isDark ? 'dark' : 'light');
		}

		// Initialize theme
		const savedTheme = localStorage.getItem('theme');
		if (savedTheme === 'dark' || (!savedTheme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
			document.body.classList.add('dark-mode');
		}

		// Input handling
		function handleInput() {
			const input = document.getElementById('messageInput');
			const sendBtn = document.getElementById('sendBtn');

			// Auto-resize textarea
			input.style.height = 'auto';
			input.style.height = input.scrollHeight + 'px';

			// Enable/disable send button
			sendBtn.disabled = !input.value.trim() || isTyping;
		}

		function handleKeyPress(event) {
			if (event.key === 'Enter' && !event.shiftKey) {
				event.preventDefault();
				sendMessage();
			}
		}

		// Message handling
		async function sendMessage() {
			const input = document.getElementById('messageInput');
			const text = input.value.trim();

			if (!text || isTyping) return;

			// Add user message
			addMessage(text, 'user');

			// Clear input
			input.value = '';
			input.style.height = 'auto';
			handleInput();

			// Show typing indicator
			showTypingIndicator();

			try {
				const response = await fetch(`${API_BASE}/v1/chat/completions`, {
					method: 'POST',
					headers: { 'Content-Type': 'application/json' },
					body: JSON.stringify({
						messages: messages.map(m => ({ role: m.role, content: m.content })),
						model: document.getElementById('modelSelect').value || undefined,
						temperature: parseFloat(document.getElementById('temperatureSlider').value),
						stream: false
					})
				});

				if (!response.ok) {
					throw new Error(`HTTP error! status: ${response.status}`);
				}

				const data = await response.json();
				const assistantMessage = data.choices[0]?.message?.content || 'Sorry, I couldn\'t generate a response.';

				hideTypingIndicator();
				addMessage(assistantMessage, 'assistant');

			} catch (error) {
				console.error('Error:', error);
				hideTypingIndicator();
				addMessage(`Error: ${error.message}`, 'assistant');
			}
		}

		function addMessage(content, role) {
			messages.push({ role, content, timestamp: Date.now() });
			renderMessages();
		}

		function renderMessages() {
			const welcomeScreen = document.getElementById('welcomeScreen');
			const messagesContainer = document.getElementById('messagesContainer');

			if (messages.length === 0) {
				welcomeScreen.classList.remove('hidden');
				messagesContainer.classList.add('hidden');
				return;
			}

			welcomeScreen.classList.add('hidden');
			messagesContainer.classList.remove('hidden');

			messagesContainer.innerHTML = messages.map(msg => {
				const avatar = msg.role === 'user' ? 'U' : 'AI';
				const content = msg.role === 'assistant'
					? `<div class="markdown-content">${marked.parse(msg.content)}</div>`
					: escapeHtml(msg.content);

				return `
					<div class="message ${msg.role}">
						<div class="message-avatar">${avatar}</div>
						<div class="message-content">
							<div class="message-bubble">${content}</div>
						</div>
					</div>
				`;
			}).join('');

			scrollToBottom();
		}

		function showTypingIndicator() {
			isTyping = true;
			const messagesContainer = document.getElementById('messagesContainer');

			const typingHtml = `
				<div class="message assistant" id="typingIndicator">
					<div class="message-avatar">AI</div>
					<div class="message-content">
						<div class="message-bubble">
							<div class="typing-indicator">
								<div class="typing-dot"></div>
								<div class="typing-dot"></div>
								<div class="typing-dot"></div>
							</div>
						</div>
					</div>
				</div>
			`;

			messagesContainer.insertAdjacentHTML('beforeend', typingHtml);
			scrollToBottom();
		}

		function hideTypingIndicator() {
			isTyping = false;
			const indicator = document.getElementById('typingIndicator');
			if (indicator) indicator.remove();
		}

		function clearChat() {
			if (messages.length === 0) return;
			if (confirm('Clear all messages?')) {
				messages = [];
				renderMessages();
			}
		}

		function scrollToBottom() {
			const chatArea = document.getElementById('chatArea');
			chatArea.scrollTop = chatArea.scrollHeight;
		}

		// Settings
		function showSettings() {
			document.getElementById('settingsModal').classList.add('active');
		}

		function closeSettings() {
			document.getElementById('settingsModal').classList.remove('active');
		}

		function closeModalOnBackdrop(event) {
			if (event.target.classList.contains('modal')) {
				closeSettings();
			}
		}

		function updateTemperatureValue() {
			const slider = document.getElementById('temperatureSlider');
			document.getElementById('temperatureValue').textContent = slider.value;
		}

		function saveSettings() {
			closeSettings();
		}

		// Utility
		function escapeHtml(text) {
			const div = document.createElement('div');
			div.textContent = text;
			return div.innerHTML;
		}

		// Configure marked
		marked.setOptions({
			breaks: true,
			gfm: true
		});

		// Initialize
		document.getElementById('messageInput').focus();
	</script>
</body>

</html>