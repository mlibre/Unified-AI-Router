<!DOCTYPE html>
<html lang="en" class="h-full">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no">
	<title>AI Chatbot</title>
	<script src="https://cdn.tailwindcss.com"></script>
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
	<script>
		tailwind.config = {
			darkMode: 'class',
			theme: {
				extend: {
					fontFamily: {
						sans: ['Inter', 'sans-serif'],
					},
					colors: {
						gray: {
							50: '#f9fafb',
							100: '#f3f4f6',
							200: '#e5e7eb',
							300: '#d1d5db',
							400: '#9ca3af',
							500: '#6b7280',
							600: '#4b5563',
							700: '#374151',
							800: '#1f2937',
							900: '#111827',
							950: '#0B0F19', // Custom dark background
						},
					},
					fontSize: {
						xxs: '0.625rem',
						smd: '0.94rem',
					},
				}
			}
		}
	</script>
	<style>
		/* Custom Scrollbar */
		.scrollbar-custom::-webkit-scrollbar {
			width: 6px;
			height: 6px;
			background-color: transparent;
		}

		.scrollbar-custom::-webkit-scrollbar-track {
			background-color: transparent;
		}

		.scrollbar-custom::-webkit-scrollbar-thumb {
			background-color: rgba(0, 0, 0, 0.1);
			border-radius: 9999px;
		}

		.scrollbar-custom:hover::-webkit-scrollbar-thumb {
			background-color: rgba(0, 0, 0, 0.2);
		}

		.dark .scrollbar-custom::-webkit-scrollbar-thumb {
			background-color: rgba(255, 255, 255, 0.1);
		}

		.dark .scrollbar-custom:hover::-webkit-scrollbar-thumb {
			background-color: rgba(255, 255, 255, 0.2);
		}

		/* Utilities */
		html,
		body {
			overscroll-behavior: none;
			touch-action: pan-x pan-y;
		}

		.btn {
			@apply inline-flex flex-shrink-0 cursor-pointer select-none items-center justify-center whitespace-nowrap outline-none transition-all focus:ring disabled:cursor-default;
		}

		/* Markdown Prose overrides for chat */
		.prose p {
			margin-bottom: 0.5em;
		}

		.prose p:last-child {
			margin-bottom: 0;
		}

		/* Typing indicator animation */
		.typing-indicator {
			display: inline-flex;
			align-items: center;
		}

		.typing-dot {
			animation: typing 1.4s infinite ease-in-out;
		}

		.typing-dot:nth-child(1) {
			animation-delay: -0.32s;
		}

		.typing-dot:nth-child(2) {
			animation-delay: -0.16s;
		}

		@keyframes typing {

			0%,
			80%,
			100% {
				transform: scale(0);
			}

			40% {
				transform: scale(1);
			}
		}
	</style>
</head>

<body class="h-full bg-white dark:bg-gray-900 text-gray-800 dark:text-gray-100 transition-colors duration-200">

	<!-- App Container -->
	<div
		class="fixed grid h-full w-full grid-cols-1 md:grid-cols-[280px,1fr] grid-rows-[1fr] overflow-hidden transition-[grid-template-columns] duration-300"
		id="app-grid">

		<!-- Sidebar (Desktop & Mobile Drawer) -->
		<nav id="sidebar"
			class="hidden md:flex flex-col h-full bg-gray-50 dark:bg-gray-950 border-r border-gray-200 dark:border-gray-800">
			<!-- Header -->
			<div class="flex items-center justify-between px-3 py-3 sticky top-0 z-10">
				<a href="#"
					class="flex items-center gap-2 rounded-xl px-2 py-2 text-lg font-bold tracking-tight hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors">
					<!-- Logo -->
					<svg class="size-7 dark:invert" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
						<path
							d="M16.0006 25.9992C13.8266 25.999 11.7118 25.2901 9.97686 23.9799C8.2419 22.6698 6.98127 20.8298 6.38599 18.7388C5.79071 16.6478 5.89323 14.4198 6.678 12.3923C7.46278 10.3648 8.88705 8.64837 10.735 7.50308C12.5829 6.35779 14.7538 5.84606 16.9187 6.04544C19.0837 6.24481 21.1246 7.14442 22.7323 8.60795C24.34 10.0715 25.4268 12.0192 25.8281 14.1559C26.2293 16.2926 25.9232 18.5019 24.9561 20.449C24.7703 20.8042 24.7223 21.2155 24.8211 21.604L25.4211 23.8316C25.4803 24.0518 25.4805 24.2837 25.4216 24.5039C25.3627 24.7242 25.2468 24.925 25.0856 25.0862C24.9244 25.2474 24.7235 25.3633 24.5033 25.4222C24.283 25.4811 24.0512 25.4809 23.831 25.4217L21.6034 24.8217C21.2172 24.7248 20.809 24.7729 20.4558 24.9567C19.0683 25.6467 17.5457 26.0068 16.0006 26.0068V25.9992Z"
							fill="black" />
					</svg>
					AI Chatbot
				</a>
				<button
					class="flex items-center justify-center rounded-lg border border-gray-200 bg-white px-2 py-1 text-xs font-medium shadow-sm hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:hover:bg-gray-700"
					onclick="createNewChat()">
					New Chat
				</button>
			</div>

			<!-- Conversation List -->
			<div class="scrollbar-custom flex-1 overflow-y-auto px-3 pb-3 pt-2">
				<div class="text-xs font-semibold text-gray-400 dark:text-gray-500 mb-2 mt-2 px-2">Conversations</div>
				<div id="conversation-list">
					<!-- Conversations will be loaded here -->
				</div>
			</div>

			<!-- Footer (Settings & Theme) -->
			<div class="mt-auto border-t border-gray-200 dark:border-gray-800 p-3 space-y-2">
				<button onclick="toggleTheme()"
					class="flex w-full items-center justify-center gap-2 rounded-lg py-2 text-xs font-medium text-gray-500 hover:bg-gray-200 dark:text-gray-400 dark:hover:bg-gray-800 transition-colors">
					<span id="theme-text">Toggle Theme</span>
				</button>
				<button onclick="showSettings()"
					class="flex w-full items-center justify-center gap-2 rounded-lg py-2 text-xs font-medium text-gray-500 hover:bg-gray-200 dark:text-gray-400 dark:hover:bg-gray-800 transition-colors">
					<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none"
						stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
						<circle cx="12" cy="12" r="3" />
						<path
							d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z" />
					</svg>
					Settings
				</button>
			</div>
		</nav>

		<!-- Mobile Header (Visible only on mobile) -->
		<div
			class="md:hidden fixed top-0 left-0 right-0 h-14 bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800 flex items-center justify-between px-4 z-20">
			<button onclick="toggleMobileNav()" class="p-1 -ml-2 text-gray-600 dark:text-gray-300">
				<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
					stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
					<line x1="3" y1="12" x2="21" y2="12"></line>
					<line x1="3" y1="6" x2="21" y2="6"></line>
					<line x1="3" y1="18" x2="21" y2="18"></line>
				</svg>
			</button>
			<span class="font-semibold text-sm">AI Chatbot</span>
			<button onclick="createNewChat()" class="p-1 -mr-2 text-gray-600 dark:text-gray-300">
				<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
					stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
					<path d="M12 5v14M5 12h14" />
				</svg>
			</button>
		</div>

		<!-- Mobile Nav Overlay -->
		<div id="mobile-nav-overlay" onclick="toggleMobileNav()"
			class="fixed inset-0 bg-black/50 z-30 hidden md:hidden transition-opacity opacity-0"></div>

		<!-- Mobile Nav Drawer -->
		<div id="mobile-nav"
			class="fixed inset-y-0 left-0 w-[280px] bg-white dark:bg-gray-900 z-40 transform -translate-x-full transition-transform duration-300 md:hidden flex flex-col">
			<!-- Clone of sidebar content for mobile -->
			<div class="p-4 border-b border-gray-200 dark:border-gray-800 flex items-center justify-between">
				<span class="font-bold text-lg">Menu</span>
				<button onclick="toggleMobileNav()" class="p-1">
					<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
						stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
						<line x1="18" y1="6" x2="6" y2="18"></line>
						<line x1="6" y1="6" x2="18" y2="18"></line>
					</svg>
				</button>
			</div>
			<div class="flex-1 overflow-y-auto p-2" id="mobile-nav-content">
				<!-- Content injected via JS -->
			</div>
		</div>

		<!-- Main Content Area -->
		<main class="relative flex flex-col h-full w-full overflow-hidden pt-14 md:pt-0">

			<!-- Chat Window -->
			<div id="chat-container" class="scrollbar-custom flex-1 overflow-y-auto scroll-smooth">
				<div class="mx-auto flex flex-col gap-6 px-4 pt-6 pb-32 max-w-3xl xl:max-w-4xl">

					<!-- Welcome / Empty State -->
					<div id="welcome-screen" class="flex-col items-center justify-center text-center mt-20">
						<div
							class="mb-6 rounded-2xl bg-white p-4 shadow-sm dark:bg-gray-800 border border-gray-100 dark:border-gray-700">
							<svg class="size-12 dark:invert" viewBox="0 0 32 32" fill="none"
								xmlns="http://www.w3.org/2000/svg">
								<path
									d="M16.0006 25.9992C13.8266 25.999 11.7118 25.2901 9.97686 23.9799C8.2419 22.6698 6.98127 20.8298 6.38599 18.7388C5.79071 16.6478 5.89323 14.4198 6.678 12.3923C7.46278 10.3648 8.88705 8.64837 10.735 7.50308C12.5829 6.35779 14.7538 5.84606 16.9187 6.04544C19.0837 6.24481 21.1246 7.14442 22.7323 8.60795C24.34 10.0715 25.4268 12.0192 25.8281 14.1559C26.2293 16.2926 25.9232 18.5019 24.9561 20.449C24.7703 20.8042 24.7223 21.2155 24.8211 21.604L25.4211 23.8316C25.4803 24.0518 25.4805 24.2837 25.4216 24.5039C25.3627 24.7242 25.2468 24.925 25.0856 25.0862C24.9244 25.2474 24.7235 25.3633 24.5033 25.4222C24.283 25.4811 24.0512 25.4809 23.831 25.4217L21.6034 24.8217C21.2172 24.7248 20.809 24.7729 20.4558 24.9567C19.0683 25.6467 17.5457 26.0068 16.0006 26.0068V25.9992Z"
									fill="black" />
							</svg>
						</div>
						<h1 class="text-2xl font-bold text-gray-900 dark:text-gray-100">AI Chatbot</h1>
						<p class="mt-2 text-gray-500 dark:text-gray-400">Powered by Unified AI Router - Making the community's
							best AI chat models available to everyone.</p>
						<button onclick="startNewConversation()"
							class="mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
							Start New Conversation
						</button>
					</div>

					<!-- Messages -->
					<div id="messages-list" class="flex flex-col gap-6">

					</div>
				</div>
			</div>

			<!-- Input Area -->
			<div
				class="absolute bottom-0 left-0 w-full bg-gradient-to-t from-white via-white to-transparent px-4 pb-4 pt-10 dark:from-gray-900 dark:via-gray-900 dark:to-transparent md:px-8 md:pb-6">
				<div class="mx-auto max-w-3xl xl:max-w-4xl">
					<div
						class="relative flex w-full items-end rounded-2xl border border-gray-200 bg-gray-50 p-2 shadow-sm transition-colors focus-within:border-gray-300 focus-within:bg-white dark:border-gray-700 dark:bg-gray-800 dark:focus-within:border-gray-600 dark:focus-within:bg-gray-800/50">

						<!-- Attach Button -->
						<button
							class="mb-1 mr-2 flex size-8 flex-none items-center justify-center rounded-full text-gray-500 hover:bg-gray-200 hover:text-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-gray-200 transition-colors"
							title="Attach file">
							<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
								stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
								<path
									d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48" />
							</svg>
						</button>

						<!-- Textarea -->
						<textarea id="chat-input" rows="1"
							class="scrollbar-custom max-h-[150px] w-full resize-none border-0 bg-transparent py-2.5 text-base text-gray-900 placeholder:text-gray-400 focus:ring-0 dark:text-gray-100 dark:placeholder:text-gray-500"
							placeholder="Ask anything..." style="min-height: 44px;"></textarea>

						<!-- Send Button -->
						<button id="send-btn"
							class="mb-1 ml-2 flex size-8 flex-none items-center justify-center rounded-full bg-black text-white transition-all hover:bg-gray-800 disabled:bg-gray-200 disabled:text-gray-400 dark:bg-white dark:text-black dark:hover:bg-gray-200 dark:disabled:bg-gray-700 dark:disabled:text-gray-500"
							disabled>
							<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
								stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
								<line x1="12" y1="19" x2="12" y2="5"></line>
								<polyline points="5 12 12 5 19 12"></polyline>
							</svg>
						</button>
					</div>
					<div class="mt-2 text-center text-xs text-gray-400 dark:text-gray-500">
						AI generated content may be inaccurate.
					</div>
				</div>
			</div>

		</main>
	</div>

	<!-- Settings Modal -->
	<div id="settings-modal" class="fixed inset-0 bg-black/50 z-50 hidden items-center justify-center">
		<div class="bg-white dark:bg-gray-800 rounded-lg p-6 w-full max-w-md mx-4">
			<h3 class="text-lg font-semibold mb-4">Settings</h3>
			<div class="space-y-4">
				<div>
					<label class="block text-sm font-medium mb-2">Model</label>
					<select id="model-select" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600">
						<option value="">Auto-select (Recommended)</option>
					</select>
				</div>
				<div>
					<label class="block text-sm font-medium mb-2">Temperature</label>
					<input type="range" id="temperature-slider" min="0" max="2" step="0.1" value="0.7" class="w-full">
					<div class="text-xs text-gray-500 mt-1">Value: <span id="temperature-value">0.7</span></div>
				</div>
				<div class="flex justify-end space-x-2">
					<button onclick="closeSettings()"
						class="px-4 py-2 text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200">Cancel</button>
					<button onclick="saveSettings()"
						class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">Save</button>
				</div>
			</div>
		</div>
	</div>

	<script>
		// --- State Management ---
		let conversations = JSON.parse(localStorage.getItem('chatbot-conversations') || '[]');
		let currentConversation = null;
		let isTyping = false;

		// --- API Configuration ---
		const API_BASE = window.location.origin;

		// --- Theme Management ---
		function toggleTheme() {
			const html = document.documentElement;
			if (html.classList.contains('dark')) {
				html.classList.remove('dark');
				localStorage.setItem('theme', 'light');
			} else {
				html.classList.add('dark');
				localStorage.setItem('theme', 'dark');
			}
		}

		// Initialize Theme
		if (localStorage.getItem('theme') === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
			document.documentElement.classList.add('dark');
		}

		// --- Mobile Navigation ---
		const mobileNav = document.getElementById('mobile-nav');
		const mobileOverlay = document.getElementById('mobile-nav-overlay');

		function toggleMobileNav() {
			const isClosed = mobileNav.classList.contains('-translate-x-full');
			if (isClosed) {
				mobileNav.classList.remove('-translate-x-full');
				mobileOverlay.classList.remove('hidden');
				setTimeout(() => mobileOverlay.classList.remove('opacity-0'), 10);
			} else {
				mobileNav.classList.add('-translate-x-full');
				mobileOverlay.classList.add('opacity-0');
				setTimeout(() => mobileOverlay.classList.add('hidden'), 300);
			}
		}

		// --- Conversation Management ---
		function createNewChat() {
			currentConversation = {
				id: Date.now(),
				title: 'New Chat',
				messages: [],
				created: new Date().toISOString()
			};
			conversations.unshift(currentConversation);
			saveConversations();
			renderConversationList();
			loadConversation(currentConversation.id);
		}

		function loadConversation(id) {
			currentConversation = conversations.find(c => c.id === id);
			if (!currentConversation) return;

			renderMessages();
			updateMobileNavContent();
		}

		function saveConversations() {
			localStorage.setItem('chatbot-conversations', JSON.stringify(conversations));
		}

		function renderConversationList() {
			const container = document.getElementById('conversation-list');
			if (conversations.length === 0) {
				container.innerHTML = '<div class="text-sm text-gray-400 px-2 py-2">No conversations yet</div>';
				return;
			}

			container.innerHTML = conversations.map(conv => `
                <a href="#" class="group flex h-10 items-center gap-2 rounded-lg px-2 text-sm transition-colors ${currentConversation && currentConversation.id === conv.id
					? 'bg-gray-200 dark:bg-gray-800 text-gray-900 dark:text-gray-100'
					: 'text-gray-600 hover:bg-gray-200 dark:text-gray-400 dark:hover:bg-gray-800'
				}" onclick="loadConversation(${conv.id})">
                    <div class="truncate flex-1">${conv.title}</div>
                    <button onclick="deleteConversation(${conv.id}); event.stopPropagation();" class="opacity-0 group-hover:opacity-100 p-1 hover:bg-red-100 dark:hover:bg-red-900 rounded">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3,6 5,6 21,6"/><path d="M19,6v14a2,2,0,0,1-2,2H7a2,2,0,0,1-2-2V6M8,6V4a2,2,0,0,1,2-2h4a2,2,0,0,1,2,2V6"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg>
                    </button>
                </a>
            `).join('');
		}

		function deleteConversation(id) {
			conversations = conversations.filter(c => c.id !== id);
			if (currentConversation && currentConversation.id === id) {
				currentConversation = conversations[0] || null;
				if (currentConversation) {
					loadConversation(currentConversation.id);
				} else {
					clearChat();
				}
			}
			saveConversations();
			renderConversationList();
		}

		function startNewConversation() {
			createNewChat();
			document.getElementById('welcome-screen').classList.add('hidden');
			document.getElementById('chat-input').focus();
		}

		function clearChat() {
			document.getElementById('messages-list').innerHTML = '';
			document.getElementById('welcome-screen').classList.remove('hidden');
		}

		// --- Message Management ---
		function addMessage(content, role) {
			if (!currentConversation) return;

			const message = {
				id: Date.now(),
				role: role,
				content: content,
				timestamp: new Date().toISOString()
			};

			currentConversation.messages.push(message);

			// Update conversation title for user messages
			if (role === 'user' && currentConversation.messages.filter(m => m.role === 'user').length === 1) {
				currentConversation.title = content.substring(0, 50) + (content.length > 50 ? '...' : '');
			}

			saveConversations();
			renderMessages();
		}

		function renderMessages() {
			const container = document.getElementById('messages-list');
			const welcome = document.getElementById('welcome-screen');

			if (!currentConversation || currentConversation.messages.length === 0) {
				welcome.classList.remove('hidden');
				container.innerHTML = '';
				return;
			}

			welcome.classList.add('hidden');

			container.innerHTML = currentConversation.messages.map(msg => {
				if (msg.role === 'user') {
					return `
                    <div class="group relative flex w-full flex-col items-end gap-2">
                        <div class="relative max-w-full rounded-3xl bg-gray-100 px-5 py-3.5 text-gray-800 dark:bg-gray-800 dark:text-gray-100">
                            <div class="whitespace-pre-wrap">${escapeHtml(msg.content)}</div>
                        </div>
                    </div>`;
				} else {
					return `
                    <div class="group relative flex w-full items-start gap-4">
                        <div class="mt-1 flex-none select-none rounded-full shadow-sm">
                            <div class="size-6 rounded-full bg-black dark:bg-white flex items-center justify-center text-white dark:text-black text-xs font-bold">AI</div>
                        </div>
                        <div class="relative min-w-0 flex-1 overflow-hidden rounded-2xl border border-gray-100 bg-white px-5 py-3.5 text-gray-800 shadow-sm dark:border-gray-800 dark:bg-gray-900 dark:text-gray-100">
                            <div class="prose prose-sm max-w-none dark:prose-invert">
                                <p>${escapeHtml(msg.content)}</p>
                            </div>
                            <!-- Footer Actions -->
                            <div class="mt-2 flex items-center gap-2 opacity-0 transition-opacity group-hover:opacity-100">
                                <button onclick="copyMessage('${msg.id}')" class="rounded p-1 text-gray-400 hover:bg-gray-100 hover:text-gray-600 dark:hover:bg-gray-800 dark:hover:text-gray-300" title="Copy">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                                </button>
                                <button onclick="regenerateResponse()" class="rounded p-1 text-gray-400 hover:bg-gray-100 hover:text-gray-600 dark:hover:bg-gray-800 dark:hover:text-gray-300" title="Regenerate">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2"/></svg>
                                </button>
                            </div>
                        </div>
                    </div>`;
				}
			}).join('');

			// Scroll to bottom
			const scrollContainer = document.getElementById('chat-container');
			scrollContainer.scrollTo({ top: scrollContainer.scrollHeight, behavior: 'smooth' });
		}

		function copyMessage(messageId) {
			const message = currentConversation.messages.find(m => m.id == messageId);
			if (message && message.role === 'assistant') {
				navigator.clipboard.writeText(message.content).then(() => {
					// Show brief feedback
					const button = event.target.closest('button');
					const originalTitle = button.title;
					button.title = 'Copied!';
					setTimeout(() => button.title = originalTitle, 1000);
				});
			}
		}

		// --- API Communication ---
		async function sendMessage() {
			const textarea = document.getElementById('chat-input');
			const text = textarea.value.trim();
			if (!text || isTyping) return;

			// Add user message
			addMessage(text, 'user');

			// Clear input
			textarea.value = '';
			textarea.style.height = 'auto';
			document.getElementById('send-btn').setAttribute('disabled', 'true');

			// Show typing indicator
			showTypingIndicator();

			try {
				const response = await fetch(`${API_BASE}/v1/chat/completions`, {
					method: 'POST',
					headers: {
						'Content-Type': 'application/json',
					},
					body: JSON.stringify({
						messages: currentConversation.messages.map(m => ({
							role: m.role,
							content: m.content
						})),
						model: document.getElementById('model-select').value || undefined,
						temperature: parseFloat(document.getElementById('temperature-slider').value),
						stream: false
					})
				});

				if (!response.ok) {
					throw new Error(`HTTP error! status: ${response.status}`);
				}

				const data = await response.json();
				const assistantMessage = data.choices[0]?.message?.content || 'Sorry, I couldn\'t generate a response.';

				hideTypingIndicator();
				addMessage(assistantMessage, 'assistant');

			} catch (error) {
				console.error('Error sending message:', error);
				hideTypingIndicator();
				addMessage(`Error: ${error.message}`, 'assistant');
			}
		}

		function showTypingIndicator() {
			isTyping = true;
			const container = document.getElementById('messages-list');
			const typingHtml = `
                <div class="group relative flex w-full items-start gap-4" id="typing-indicator">
                    <div class="mt-1 flex-none select-none rounded-full shadow-sm">
                        <div class="size-6 rounded-full bg-black dark:bg-white flex items-center justify-center text-white dark:text-black text-xs font-bold">AI</div>
                    </div>
                    <div class="relative min-w-0 flex-1 overflow-hidden rounded-2xl border border-gray-100 bg-white px-5 py-3.5 text-gray-800 shadow-sm dark:border-gray-800 dark:bg-gray-900 dark:text-gray-100">
                        <div class="typing-indicator">
                            <span class="text-gray-500 dark:text-gray-400">AI is thinking</span>
                            <div class="flex ml-2 space-x-1">
                                <div class="w-2 h-2 bg-gray-400 rounded-full typing-dot"></div>
                                <div class="w-2 h-2 bg-gray-400 rounded-full typing-dot"></div>
                                <div class="w-2 h-2 bg-gray-400 rounded-full typing-dot"></div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
			container.insertAdjacentHTML('beforeend', typingHtml);

			// Scroll to bottom
			const scrollContainer = document.getElementById('chat-container');
			scrollContainer.scrollTo({ top: scrollContainer.scrollHeight, behavior: 'smooth' });
		}

		function hideTypingIndicator() {
			isTyping = false;
			const typingIndicator = document.getElementById('typing-indicator');
			if (typingIndicator) {
				typingIndicator.remove();
			}
		}

		function regenerateResponse() {
			if (currentConversation && currentConversation.messages.length > 0) {
				// Remove the last assistant message
				for (let i = currentConversation.messages.length - 1; i >= 0; i--) {
					if (currentConversation.messages[i].role === 'assistant') {
						currentConversation.messages.splice(i, 1);
						break;
					}
				}

				// Get the last user message
				const lastUserMessage = currentConversation.messages.filter(m => m.role === 'user').pop();
				if (lastUserMessage) {
					// Remove the last user message and resend
					for (let i = currentConversation.messages.length - 1; i >= 0; i--) {
						if (currentConversation.messages[i].id === lastUserMessage.id) {
							currentConversation.messages.splice(i, 1);
							break;
						}
					}

					renderMessages();
					// Resend the message
					document.getElementById('chat-input').value = lastUserMessage.content;
					sendMessage();
				}
			}
		}

		// --- Settings Management ---
		function showSettings() {
			document.getElementById('settings-modal').classList.remove('hidden');
			document.getElementById('settings-modal').classList.add('flex');
		}

		function closeSettings() {
			document.getElementById('settings-modal').classList.add('hidden');
			document.getElementById('settings-modal').classList.remove('flex');
		}

		function saveSettings() {
			// Settings are automatically saved through the form values
			closeSettings();
		}

		// --- Utility Functions ---
		function escapeHtml(text) {
			const div = document.createElement('div');
			div.textContent = text;
			return div.innerHTML;
		}

		function updateMobileNavContent() {
			const sidebarContent = document.querySelector('#sidebar .scrollbar-custom').innerHTML;
			document.getElementById('mobile-nav-content').innerHTML = sidebarContent;
		}

		// --- Event Listeners ---
		// Auto-resize Textarea
		const textarea = document.getElementById('chat-input');
		const sendBtn = document.getElementById('send-btn');

		textarea.addEventListener('input', function () {
			this.style.height = 'auto';
			this.style.height = (this.scrollHeight) + 'px';

			if (this.value.trim().length > 0 && !isTyping) {
				sendBtn.removeAttribute('disabled');
			} else {
				sendBtn.setAttribute('disabled', 'true');
			}
		});

		// Send Message Events
		sendBtn.addEventListener('click', sendMessage);
		textarea.addEventListener('keydown', (e) => {
			if (e.key === 'Enter' && !e.shiftKey) {
				e.preventDefault();
				sendMessage();
			}
		});

		// Temperature slider
		document.getElementById('temperature-slider').addEventListener('input', function () {
			document.getElementById('temperature-value').textContent = this.value;
		});

		// Close modal on backdrop click
		document.getElementById('settings-modal').addEventListener('click', function (e) {
			if (e.target === this) {
				closeSettings();
			}
		});

		// --- Initialization ---
		function init() {
			renderConversationList();

			// Load most recent conversation if exists
			if (conversations.length > 0) {
				loadConversation(conversations[0].id);
			}
		}

		// Initialize the app
		init();
	</script>
</body>

</html>